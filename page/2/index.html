<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Try try try Never mind">
<meta property="og:type" content="website">
<meta property="og:title" content="Yiyang&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Yiyang&#39;s Blog">
<meta property="og:description" content="Try try try Never mind">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yiyang&#39;s Blog">
<meta name="twitter:description" content="Try try try Never mind">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Yiyang's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3b9de7582df94dad7be13b2e75675386";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yiyang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/04/有趣的概率题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/04/有趣的概率题/" itemprop="url">有趣的概率题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-04T16:41:00+08:00">
                2017-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数学/" itemprop="url" rel="index">
                    <span itemprop="name">数学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="袜子抽屉"><a href="#袜子抽屉" class="headerlink" title="袜子抽屉"></a>袜子抽屉</h1><p>一个抽屉有红袜子和黑袜子，随机取出两支袜子都是红袜子的概率是0.5,(a)抽屉里最少有几只袜子？(b)如果抽屉中黑袜子的数量是偶数，抽屉里最少有几只袜子？<br>(a)4<br>(b)21<br><img src="http://img.blog.csdn.net/20170304165618520?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="连胜"><a href="#连胜" class="headerlink" title="连胜"></a>连胜</h1><p>为了激励小明的网球生涯，如果他在三盘中连赢2盘，他爹就给他奖励，小明每盘可从他爹和俱乐部冠军中选一个作为对手，但不能连续选择一个人2次，即“爹-冠军-爹”或“冠军-爹-冠军”。冠军的水平比他爹高。小明应该选择哪种顺序？<br><img src="http://img.blog.csdn.net/20170304165337076?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="轻浮的陪审员"><a href="#轻浮的陪审员" class="headerlink" title="轻浮的陪审员"></a>轻浮的陪审员</h1><p>三人陪审团中有2位以概率p独立地做出正确的决定，第三个人靠抛硬币做决定，最后以多数原则做出最后决定。另一个陪审团只有一个人，以概率p做正确决定。哪个陪审团更公正<br><img src="http://img.blog.csdn.net/20170305102314119?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="抛到6为止"><a href="#抛到6为止" class="headerlink" title="抛到6为止"></a>抛到6为止</h1><p>平均需要掷几次色子才会掷出6？</p>
<ul>
<li>解法1：<br><img src="http://img.blog.csdn.net/20170305145156614?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></li>
<li>解法2：设平均需要掷m次色子才会掷出6，这是一个期望值。若第一次掷出的不是6（概率为q=1-p=5/6），则还需要掷m次，共掷m+1次；若第一次掷出6(概率为p=1/6)，则不需要再掷了，共掷1次。又总的期望应该是m，则有qx(m+1)+px1=m，解得m=1/p=6</li>
<li>解法3：<br>这是一个伯努利过程，首次成功的总实验次数俯冲参数为p的几何分布，次数的期望为1/p=6</li>
</ul>
<h1 id="方形中的硬币"><a href="#方形中的硬币" class="headerlink" title="方形中的硬币"></a>方形中的硬币</h1><p>在一个游戏中，一位玩家从5英尺的距离处抛掷一枚直径3/4英寸的便士到1平方英寸的方形桌面上。若便士完全落在桌子内，他将获得5先令，但无论输赢都不能拿回他的便士，如果便士落在桌子上，他赢的机会有多大。<br>不知道我翻译错没有，答案是1/16。</p>
<p><img src="http://img.blog.csdn.net/20170308222948394?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="Chuck-a-Luck"><a href="#Chuck-a-Luck" class="headerlink" title="Chuck-a-Luck"></a>Chuck-a-Luck</h1><p>Chuck-a-Luck是一种赌博游戏，玩家可给1，2，3，4，5，6中的任意数字下注，可同时给不同的数字下不同的筹码。庄家抛3个色子，若玩家的数字出现在1个，2个或3个色子中，他将相应地赢取所下注筹码的1倍、2倍、3倍，并赢回自己的筹码，否则输掉他下注的筹码。玩家们每单位筹码的期望损失是多少？<br>这个问题的理解有点难度，容易以玩家的角色带入，若把问题看作庄家每单位筹码的期望盈利是多少则会简单很多。这样我们可以合理地假设所有玩家给每个数字下注的机会是均等的，把所有玩家抽象为一个玩家，他每次给1,2,3,4,5,6都下注一个单位的筹码。</p>
<ol>
<li>当我们(庄家)开出三个不同的数字时，玩家获利3个单位，同时损失3个单位，我们没有盈利；这种情况第一个色子有6个数字可选，第二个有5个，第三个四个，有6x5x4=120种排列，每个色子有6种取法，三个色子共有6x6x6=216种排列，发生的概率是$120\over 216$；</li>
<li>当我们开出2个一样的数字时，玩家获利3个单位，同时损失4个单位，我们盈利1个单位，平均每单位筹码盈利$1\over 6$个单位筹码；该情况下从3个色子中取2个作为一样的数字，有3种取法，这两个色子的有6个数字可选，第三个色子只有5个数字可选，有$(_2^3)$x6x5=90种排列，发生的概率是$90 \over 216$；</li>
<li>当我们开出3个一样的数字时，玩家获利3个单位，同时损失5个单位，我们盈利2个单位，平均每单位筹码盈利${2 \over 6}={1 \over 3}$单位的筹码；这种情况在6个数字中选一个作为重复3次的数字，有6种取法，三个色子都只能从这个数字中选择，共6种排列，发生的概率是$6 \over 216$。</li>
</ol>
<p>三种情况的概率之和为1，不会再有别的情况了。因此我们庄家的期望收益是<br>$$0 \times \frac{120}{216} + \frac{1}{6} \times \frac{90}{216} + \frac{1}{3} \times \frac{6}{216} = \frac{17}{216} \approx 0.0787$$（比0.0398的50年中国国债收益高多了，还是不如房地产，果然是地产兴邦）。<br>因此玩家们的每单位筹码的损失是0.0787。 转轮相当于更多面的色子，指针或珠子停住的位置上的数字相当于色子开出的点数，比扔色子盈利更高，玩家损失更多, 所以说玩家还是要远离赌博。</p>
<h1 id="治疗强迫症赌徒"><a href="#治疗强迫症赌徒" class="headerlink" title="治疗强迫症赌徒"></a>治疗强迫症赌徒</h1><p>轮盘上有38个等可能的数字，如果玩家猜的数字中了，他将获得35倍的筹码以及他下注的筹码；否则输掉他下注的筹码。小明他爹不听小明的劝阻，总是在轮盘的13号位赌1块钱。为了帮助治疗他爹的强迫症，小明总是赌20块钱他爹将再36轮后亏本，（他爹亏本了就给小明20块钱，没亏本就挣小明20块钱），小明能让他爹吃到教训吗？</p>
<ul>
<li>这个问题首先要搞清楚小明他爹在36轮后亏本的概率分布，什么情况下亏本，什么情况下不亏本。试着算一下，36轮中只要赢一次，$+35 \times 1 + (-1) \times 35=0$，他爹正好不亏，36轮全输了才亏本，因此他爹36轮后亏本的概率分布为</li>
</ul>
<table>
<thead>
<tr>
<th>情况</th>
<th>亏本</th>
<th>不亏本</th>
</tr>
</thead>
<tbody>
<tr>
<td>概率</td>
<td>$({37 \over 38})^{36} \approx 0.383$</td>
<td>$1-0.383=0.617$</td>
</tr>
</tbody>
</table>
<p>因此小明他爹从小明那盈利的期望：$20 \times 0.617 +(– 20) \times 0.383 = 4.68$</p>
<ul>
<li>小明他爹每轮从赌场那盈利的期望：$35\times{1 \over 38} +(-1)\times{37 \over 38} = -{2 \over 38}$<br>36轮后从赌场盈利的期望：$-{2 \over 38} \times 36 \approx -1.89$</li>
<li>最后，小明他爹36轮后盈利的总期望：$4.68 – 1.89 = 2.99$</li>
</ul>
<p>哈哈，看来小明可能先吃到教训。不过要是小明运气好的话，可能小明他爹在第一次亏掉36+20=56块钱之后就不玩了。</p>
<h1 id="一手完美桥牌"><a href="#一手完美桥牌" class="headerlink" title="一手完美桥牌"></a>一手完美桥牌</h1><p>桥牌一般是扑克去掉大小王后的52张牌，4位玩家每人发13张牌。我们常听说某人被发了13张同花顺。在一副洗好的桥牌里获得一手同花顺的概率是多少？<br>$$\frac{4(^{13}_{13})}{(^{52}_{13})}=6.299 \times 10^{-12}$$</p>
<h1 id="Craps"><a href="#Craps" class="headerlink" title="Craps"></a>Craps</h1><p>Craps，也就是掷骰子，是美国玩起来最快也最流行的赌博游戏。每次掷2个骰子并合计点数，先掷出7或11的获胜，一旦掷出2,3或12则输了。掷出了其他的点数称为point，如果你先掷出的是point，那么你需要一直掷骰子直到你再掷出一次同样的point就算赢，掷出7则算输。每个玩家赢的概率有多大？</p>
<ul>
<li>2个骰子的和的分布律：</li>
</ul>
<table>
<thead>
<tr>
<th>total</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>12</th>
</tr>
</thead>
<tbody>
<tr>
<td>p</td>
<td>${1 \over 36}$</td>
<td>${2 \over 36}$</td>
<td>${3 \over 36}$</td>
<td>${4 \over 36}$</td>
<td>${5 \over 36}$</td>
<td>${6 \over 36}$</td>
<td>${5 \over 36}$</td>
<td>${4 \over 36}$</td>
<td>${3 \over 36}$</td>
<td>${2 \over 36}$</td>
<td>${1 \over 36}$</td>
</tr>
</tbody>
</table>
<ul>
<li>第一次掷骰子情况</li>
</ul>
<table>
<thead>
<tr>
<th>case</th>
<th>total</th>
<th>sum</th>
</tr>
</thead>
<tbody>
<tr>
<td>win</td>
<td>7,11</td>
<td>6/36+2/36=8/36</td>
</tr>
<tr>
<td>lose</td>
<td>2,3,12</td>
<td>1/36+2/36+1/36=4/36</td>
</tr>
<tr>
<td>point</td>
<td>4,5,6,8,9,10</td>
<td>/36+4/36+5/36+5/36+4/36+3/36=24/36</td>
</tr>
</tbody>
</table>
<p>掷出point之后，需要重复掷骰子，虽然每次掷骰子有三种情况，输、赢和“再来一次”。但是总的来说你只有2个结果，输或者赢。如果你第一次掷的point是4，那么往后你掷出4就赢，掷出7就输，所以你赢的(条件)概率为p4/(p4+p7)=(3/36)/(3/36+6/36)=1/3，你可以理解为：将没事的情况里无限细分，最后所有赢的概率的和的极限就是1/3。其他的条件概率同理有：<br>5：p5/(p5+p7) = (4/36)/(4/36+6/36) = 2/5<br>6：p6/(p6+p7) = (5/36)/(5/36+6/36) = 5/11<br>8：p8/(p8+p7) = (5/36)/(5/36+6/36) = 5/11<br>9：p9/(p9+p7) = (4/36)/(4/36+6/36) = 2/5<br>10：p10/(p10+p7) = (3/36)/(3/36+6/36) = 1/3</p>
<p>因此总的来说赢的概率为<br>8/36 + (3/36 x 1/3 + 4/36 x 2/5 + 5/36 x 5/11 + 5/36 x 5/11 + 4/36 x 2/5 + 3/36 x 1/3) ≈0.49293</p>
<p>那么玩家没单位筹码的盈利期望为：1x(1-0.49293) +(– 1)x0.49293 = -0.01414, 每单位筹码的损失率是1.41%</p>
<p>再回头来看看条件概率的计算。假设你掷出point（赢）的概率为P，再算上你掷出7（输）的概率为6/36，那么你“再来一次”的概率为R=1-P-6/36。因此从第二次掷骰子开始(包括第二次)，你赢的概率为<br>P+RP+R2P+R3P+… = P(1+R+R2+R3+…) = P/(1-R) = P/[1-(1-P-6/36)] = P/(P+6/36)，与上面的计算相同。</p>
<h1 id="个人对于赌注的承受实验"><a href="#个人对于赌注的承受实验" class="headerlink" title="个人对于赌注的承受实验"></a>个人对于赌注的承受实验</h1><p>(a) 瓮中有10个黑球和10个白球，你指定颜色黑或白，再随机取球，若球的颜色和你指定的颜色匹配，你赢的10块钱。如果玩这个游戏需要花钱，你最多愿意花多少钱去玩这个游戏，假设只玩一次。<br>(b) 有的朋友有许多黑球和白球，他随意往瓮里求了若干白球和黑球，这次你最多愿意花多少钱玩？<br>A能算出期望，是5块钱，但是大部分人真不愿意付出5块钱，就玩一次，大多数人估计只愿意付出几毛钱或者几分钱。这个赌博游戏要是真设计成这样，玩一次只要几毛钱，黑白球比例还是1:1，那么庄家肯定要亏惨，但是你要玩家至少出5块钱那肯定没人玩。<br>(b) 和a一样，你猜中的概率是0.5，就算瓮里全部是黑球，在你不知道的情况下，你的选项还是2个，猜中的概率还是0.5。不过这游戏恐怕更没人玩了，条件太少了，让人觉得根本就是瞎扯。哈哈，实际上两个游戏一样都是瞎猜。</p>
<h1 id="沉默的合作"><a href="#沉默的合作" class="headerlink" title="沉默的合作"></a>沉默的合作</h1><p>两个陌生人被分开地要求从所有数字中选择一个正数，如果两个人选择的数字恰好相同则会获得奖励，你会选择哪个数字？<br>这听起来像是个0概率事件。但是这种选择不是随机选择，每个数字对人们的吸引力是不一样的。一想到要选一个别人也很可能会选择的数，没人会选择超过个位数的数，1最自然的想法，也是最多被选择的数，有的人也选择3和7。</p>
<h1 id="Quo-Vadis-拉丁语，你去往何处？"><a href="#Quo-Vadis-拉丁语，你去往何处？" class="headerlink" title="Quo Vadis? (拉丁语，你去往何处？)"></a>Quo Vadis? (拉丁语，你去往何处？)</h1><p>2个仅通过密码联系的陌生人约定星期四中午12点在纽约会面，准备干一票大的。他们都不熟悉纽约，结果这俩2逼出发后才发现他们忘记约定在纽约的那里会面。然而他们还是想见面，你说他们会去哪里？<br>帝国大厦，机场，火车站信息台，自由女神像，时代广场，都是1964年能想到的地方。 当陌生人知道到达那里是多么困难的时候，自由女神像就会被排除。 机场距离城市距离很远也会被排除。 在我(作者)看来，有两个重要的火车站将被排除。 这将留下帝国大厦或时代广场。 我会选择帝国大厦，因为时代广场日益庞大。 我认为如果他们在旧金山或巴黎见过面，他们的问题会更容易，不是吗？</p>
<h1 id="囚犯的抉择"><a href="#囚犯的抉择" class="headerlink" title="囚犯的抉择"></a>囚犯的抉择</h1><p>A,B,C三位申请假释的囚犯，有着同样良好的记录。假释委员会通过了其中2位囚犯的申请，但是囚犯们还不知道是他们3人中的哪2位。囚犯A有个预警朋友知道谁将被允许假释。囚犯A觉得不太好意思直接问自己是否被释放，于是他想问B和C是否被释放。他认为他现在被释放的概率是2/3，一旦预警回答”B将被释放”，那么它自己被释放的概率就变成了1/2。因此A打消了问预警的念头，他害怕自己被释放的概率减小。这种想法显然是错误的，请问错在哪？<br>他的样本空间考虑错了<br>谁被释放这是一个事件m：A,B,C被释放的情况有AB, AC, BC三种情况，<br>再考虑另一个事件n：预警回答B或C, (A只询问预警B和C的情况)<br>根据贝叶斯公式，当预警说B被释放时，A被释放的后验概率为<br>
$$\begin{eqnarray}
P(m=AB│n=B) &=& \frac{P(m=AB,n=B)}{P(n=B)} \\
&=& \frac{P(m=AB) \times P(n=B│m=AB)}{P(m=AB)\times P(n=B│m=AB)+P(m=BC) \times P(n=B│m=BC)} \\
&=& \frac{{1 \over 3} \times 1}{{1 \over 3} \times 1+{1 \over 3} \times {1 \over 2}} \\
&=& {2 \over 3}
\end{eqnarray}$$
</p>
<h1 id="收集优惠券"><a href="#收集优惠券" class="headerlink" title="收集优惠券"></a>收集优惠券</h1><p>麦片盒中的优惠券有1至5号，每盒麦片里都有一张优惠券，获得每种优惠券的机会均等，集齐这5种优惠券可以得到一个奖励，平均买多少盒麦片可以集齐一套优惠券？</p>
<p>这跟做多少次实验首次成功差不多，可以把这个问题看作五段伯努利过程，每一段的参数不一样：</p>
<ol>
<li>第一段伯努利过程中，获得所需优惠券的概率为1，因此只需买1盒；</li>
<li>第二段伯努利过程，因为已经得到一种优惠券了，我想要的优惠券变为剩下的四种，所以获得所需优惠券的概率为4/5，伯努利过程中首次成功的实验次数服从参数为p几何分布, 其分布列为<br>$$P(k) = p(1-p)^{k-1}, k=1,2,…$$ 几何分布的期望为1/p,因此获得第二种所需优惠券需要买1/p=1/(4/5)=5/4=1.25盒;</li>
<li>第三段伯努利过程中获得所需优惠券的概率为3/5，需要买5/3=1.67盒;</li>
<li>第四段伯努利过程中获得所需优惠券的概率为2/5，需要买5/2=2.5盒;</li>
<li>第五段伯努利过程中获得所需优惠券的概率为1/5，需要买5/1=5盒;</li>
</ol>
<p>至此收集完5中优惠券平均共需买麦片<br>1+1.25+1.67+2.5+5= 11.42盒</p>
<h1 id="音乐会的一排座位"><a href="#音乐会的一排座位" class="headerlink" title="音乐会的一排座位"></a>音乐会的一排座位</h1><p>8位单身汉和7位美丽的模特随机坐在音乐会中一排座位中的任意位置。平均出现几对男女邻座？<br>1对邻座刚好坐着一对男女的情况为“男女”或“女男” ，发生的概率是<br>8/15×7/14+7/15×8/14=8/15<br>也就是说，1对邻座平均坐着1×8/15+0×(1-8/15)=8/15对男女。15个座位共有14对邻座，根据和的期望等于期望的和，14对邻座中男女对数的期望等于1对邻座的男女对数期望的14倍。因此15个座位产生的男女对数为14*8/15=7.4667对</p>
<h1 id="第二好能成为亚军吗？"><a href="#第二好能成为亚军吗？" class="headerlink" title="第二好能成为亚军吗？"></a>第二好能成为亚军吗？</h1><p>8位运动员参加网球比赛，赛程如下图<br> <img src="http://img.blog.csdn.net/20170510131306805?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>假设每场比赛的胜负只有运动员的水平决定。最好的运动员一定获得冠军，那么第二好的运动员获得亚军的概率是多少？<br>4/7，第二好的运动员要获得亚军必须在finals才与第一好相遇，那么他在第一轮要被分在和第一好不同的另一半边。第一好占了一个位置，所以是4/7</p>
<h1 id="双胞胎骑士"><a href="#双胞胎骑士" class="headerlink" title="双胞胎骑士"></a>双胞胎骑士</h1><p>（a）亚瑟王举办Jousting比赛（两个骑士拿着长矛对冲），8位骑士参加，包括双胞胎Balin和Balan，依然按照16题中的赛程比赛，求他俩在比赛中相遇的概率?<br>这里不知道各个骑士水平谁好谁坏，只能假设每个骑士赢的概率都是1/2.<br>假设双胞胎中的一位被分在某个位置，不妨设为1，另一位和他在同一小组（如位置2）的概率为1/7, 而此时相遇大概率为1；<br>另一位和他在相邻的小组（如位置3或4）的概率为2/7, 而此时相遇大概率为1/4；<br>另一位在另一半大组（如位置5,6,7,8）的概率为4/7, 而此时相遇大概率为1/16；<br>因此他两相遇的概率为<br>$${1 \over7 } \cdot 1+{2 \over 7} \cdot {1 \over 4}+{4 \over 7} \cdot {1 \over 16}={1 \over 4}$$<br>（b）将(a)中的8改为$2^n$?</p>
<table>
<thead>
<tr>
<th>n</th>
<th>p</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>1/2</td>
</tr>
<tr>
<td>3</td>
<td>1/4</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>n</td>
<td>1/$2^{n-1}$</td>
</tr>
</tbody>
</table>
<p>或者:<br>$2^n$中的n表示要比赛n轮，若1人被随机分到这一大半边，另一人被分到另一大半边的概率为${2^{n-1} \over 2^n-1}$，其中一人杀到第n轮的概率为${1\over 2^{n-1}}$ ，两人都杀到第n轮的概率为${1\over 2^{n-1}}\cdot {1\over 2^{n-1}}={1\over 2^{2(n-1)}}$，所以两人在第$n$轮相遇的概率为<br>$$\frac{2^{n-1}}{2^n-1}\cdot \frac{1}{2^{2(n-1)}}$$<br>两人在第$i$轮相遇的概率为<br>$$\frac{2^{i-1}}{2^n-1}\cdot \frac{1}{2^{2(i-1)}}$$<br>相遇的总概率为第$1,2,3,…,n$轮相遇的概率之和<br> $$\begin{aligned}<br> \sum<em>{i=1}^n\frac{2^{i-1}}{2^n-1}\cdot \frac{1}{2^{2(i-1)}}<br>=\frac{1}{2^n-1}\sum</em>{i=1}^n\frac{1}{2^{i-1}}<br>=\frac{2}{2^n-1}\sum_{i=1}^n\frac{1}{2^i}<br>=\frac{2}{2^n-1}(1-\frac{1}{2^n})=\frac{1}{2^{n-1}}<br>\end{aligned}$$</p>
<h1 id="抛均匀的硬币"><a href="#抛均匀的硬币" class="headerlink" title="抛均匀的硬币"></a>抛均匀的硬币</h1><p>抛100次硬币，正好50次正面朝上的概率？<br>很简单，二项分布<br>$$p=\binom{100}{50}({1\over2})^{100}=\frac{100!}{50!50!}({1\over2})^{100}$$<br>难点是没有计算器怎么办？<br>根据斯特林公式（Stirling’s approximation）<br>$$n! \approx \sqrt{2\pi}n^{n+{1\over2}}e^{-n}$$<br>有时也能简便一点</p>
<h1 id="艾萨克·牛顿帮助塞缪尔·佩皮斯"><a href="#艾萨克·牛顿帮助塞缪尔·佩皮斯" class="headerlink" title="艾萨克·牛顿帮助塞缪尔·佩皮斯"></a>艾萨克·牛顿帮助塞缪尔·佩皮斯</h1><p>佩皮斯写信给牛顿问下面那件事是最可能发生的<br>（a）    掷6个骰子，至少得到1个6<br>（b）    掷12个骰子，至少得到2个6<br>（c）    掷18个骰子，至少得到3个6<br><img src="http://img.blog.csdn.net/20170528153307598?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<h1 id="三角决斗"><a href="#三角决斗" class="headerlink" title="三角决斗"></a>三角决斗</h1><p>A，B和C玩三角手枪决斗。 所有人都知道，A的命中率是0.3，C是0.5，B不会失误。 他们将按照A，B，C循环的顺序自由选择目标决斗，直到最后一个人活下来。A的策略应该是什么？<br> <img src="http://img.blog.csdn.net/20170528163254932?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>如上图，若A先射C, A赢的概率是0.21，若A先射击B, A赢的概率将大于0.21. 因此A应先射B。此时的局面是AC互射，A赢的情况只可能为C一直射不中A, 而A在最后一次射击时射中了C, 因此A赢的概率为<br>C射1次A没射中, A第1次射就射死C:  $0.5 \times 0.3 +$<br>C射2次A没射中, A第2次射才射死C:  $0.5^2 \times 0.7 \times 0.3+$<br>C射3次A没射中, A第3次射才射死C:  $0.5^3 \times 0.7^2 \times 0.3 +$<br>C射4次A没射中, A第4次射才射死C:  $0.5^4 \times 0.7^3 \times 0.3 + $<br>…<br>这是个无穷递减等比数列求和，比值为0.5x0.7=0.35<br>$0.5 \times 0.3 \times (1+0.5 \times 0.7+(0.5 \times 0.7)^2+(0.5 \times 0.7)^3+…)=0.5 \times 0.3 \times \frac{1}{1-0.35}=3/13$<br>因此，若A先射B, A赢的概率为$0.21+0.3 \times 3/13=0.279$.<br>起码A的生还几率大了近7个点</p>
<h1 id="放回抽样还是不放回抽样"><a href="#放回抽样还是不放回抽样" class="headerlink" title="放回抽样还是不放回抽样"></a>放回抽样还是不放回抽样</h1><p>两个装有红球和黑球的桶。A桶有2个红球和1个黑球，B桶有101个红球和100个黑球。桶被随机选择。在第一个球被取出并报告颜色后你可以决定它是否放回原来的桶中（当然你看不到是哪个桶），再从这个桶中取出第二个球（2个球来自同一个桶），你根据这2个球的颜色判断它们来自哪个桶，判断对了可获得奖励。</p>
<p>如果第一个取出的球是红色，被取出球的桶剩余的红球数与黑球数相等，这样不好做判断，因此最好放回；若第一个取出的球是黑色，被取出桶中的黑球更少了，有利于我们根据期望判断。<br>假设第1次取出红球，放回红球，再取出又是红球。<br>如果球来自A桶，这种情况发生的概率为1/2<em>2/3</em>2/3=0.222<br>如果球来自B桶，这种情况发生的概率为1/2<em>101/201</em>101/201=0.126<br>当球来自A桶，这种情况发生的概率大，因此我们推断球来自A桶<br>同样地有<br><img src="http://img.blog.csdn.net/20170531232638938?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcTF3MmUzcjQ0NzA=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><div id="container"></div></p>
<p><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"></p>
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  id: 'interesting_probabilities',
  title: '有趣的概率题',
  owner: 'yiyang186',
  repo: 'blog_comment',
  oauth: {
    client_id: '2786ddc8538588bfc0c8',
    client_secret: '83713f049f4b7296d27fe579a30cdfe9e2e45215',
  },
})
gitment.render('container')
</script>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/11/线性回归/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/11/线性回归/" itemprop="url">线性回归</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-11T17:13:00+08:00">
                2016-11-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/机器学习/" itemprop="url" rel="index">
                    <span itemprop="name">机器学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="线性模型使用范围"><a href="#线性模型使用范围" class="headerlink" title="线性模型使用范围"></a>线性模型使用范围</h1><p>相比于非线性模型，线性模型更适用于：</p>
<ol>
<li>小数据集</li>
<li>低信噪比</li>
<li>稀疏数据</li>
</ol>
<h1 id="线性回归模型"><a href="#线性回归模型" class="headerlink" title="线性回归模型"></a>线性回归模型</h1><p>约定数据集$X=(X_1,X_2,...,X_p)$有p个特征，$X_j \in R^N$共N个样本。<br>$$f(X)=\beta_0+\sum_{i=1}^p X_j\beta_j$$</p>
<p>给X增加一列1，$X=(1, X_1,X_2,...,X_p)$， $\beta=(\beta_0, \beta_1, ..., \beta_p)^T$，上式可写成矩阵形式：<br>$$f(X)=X\beta$$</p>
<p>这里的$f(X)$为真实模型，$\beta$为真实模型参数，相对应的有估计模型和估计参数, 估计模型的结果为估计的响应变量y<br>$$\hat{y}=\hat{f}(X)=X\hat{\beta}$$</p>
<p>在统计学习里，我们一般认为真实的,即观测到的响应变量为估计与误差的叠加<br>$$y=\hat f(X)+\varepsilon=X \hat \beta+\varepsilon$$</p>
<p>这里$\varepsilon=(\varepsilon_0, \varepsilon_1,...,\varepsilon_N)^T$, 是每个样本预测值和真实值的误差组成的向量，假设它服从高斯分布<br>$$\varepsilon \sim N(0, \sigma^2I_N )$$</p>
<p>那么y也服从高斯分布<br>$$y \sim N(X\beta, \sigma^2I_N )$$</p>
<p>根据X的不同来源，线性模型的表达能力可以得到极大的扩展：</p>
<ul>
<li>定量输入</li>
<li>定量输入的变换，如log, 平方根，平方</li>
<li>基展开，如$X_2=X_1^2, X_3=X_1^3$</li>
<li>哑变量，类别变量做独热编码变成的由0，1组成的稀疏矩阵</li>
<li>交互项，如$X_3=X_1X_2$</li>
</ul>
<h1 id="最小二乘法"><a href="#最小二乘法" class="headerlink" title="最小二乘法"></a>最小二乘法</h1><h2 id="求解方法与理解"><a href="#求解方法与理解" class="headerlink" title="求解方法与理解"></a>求解方法与理解</h2><p>为了求得真实模型，我们希望y和$\hat{y}=X\hat \beta$的误差尽量小，因此需要求得使残差平方和$RSS(\beta)=(y-X\beta)^T(y-X\beta)$最小的模型参数$\beta$，这是无约束二次优化问题，直接求导即可<br>$$\frac{\partial RSS(\beta)}{\partial \beta}=-2X^T(y-X\beta)=0$$</p>
<p>$$X^TX\beta = X^Ty$$</p>
<p>当X列满秩时，若以y为未知数，方程组Xy=0中y只有0解，而这里y≠0，因此Xy≠0，所以$y^T(X^TX)y=(Xy)^T(Xy)&gt;0$，即$X^TX$正定，非奇异，则<br>$$\hat{\beta} = (X^TX)^{-1}X^Ty$$</p>
<p>其实，要使所求解为极小值点也必须满足<br>$$\frac{\partial ^2RSS(\beta)}{\partial \beta \partial \beta^T}=2X^TX&gt;0$$</p>
<p>因此X列满秩是必须满足的条件。下面只讨论X列满秩的情况。<br>那么<br>$$\hat{y} =X\hat{\beta}$$</p>
<p>可见，$\hat{y}$是X列向量的线性组合，$\hat{y} \in span<x_0, x_1,...,x_p="">$，所以<br>$$dim(\hat y)=p+1$$</x_0,></p>
<p>真实的$y=f(X)+\varepsilon$, 由于误差的存在，y不在X的列空间里边。所以，对于最小二乘法来说，最小化残差平方和$min||y-\hat{y}||^2$即找到一个$\hat y$使得$y-\hat y$正交于X的列空间。此时，$||y-\hat{y}||$取得最小值，放张图感受一下。<br><img src="http://img.blog.csdn.net/20161111093602494" alt="这里写图片描述"><br>根据维数公式，有<br>$$\begin{aligned}dim(y)<br>    &amp;=dim(\hat y) + dim(y-\hat y)-dim(\hat y\bigcap (y-\hat y))\<br>    &amp;=dim(\hat y) + dim(y-\hat y)\<br>    \end{aligned}$$</p>
<p>所以，$dim(y-\hat y) = dim(y)-dim(\hat y) = N-(p+1)$(求这个是为了后面求卡方分布的自由度)<br>那么，什么是回归？就是求y在X列空间的投影，所以我们说$\hat{y}$是y在X上的回归。而最小二乘法所做的就是找到这种正交映射。令$H=X(X^TX)^{-1}X^T$<br>$$\hat{y} =X\hat{\beta}=X(X^TX)^{-1}X^Ty=Hy$$</p>
<p>H就是这个投影矩阵。</p>
<h2 id="hat-beta-的期望与方差"><a href="#hat-beta-的期望与方差" class="headerlink" title="$\hat \beta$的期望与方差"></a>$\hat \beta$的期望与方差</h2><p>我们估计的$\hat{\beta}$与真实的$\beta$差别有多大呢？<br>
$$\begin{aligned}E_{Y|X}(\hat{\beta})
	&=E_{Y|X}((X^TX)^{-1}X^Ty)\\
	&=(X^TX)^{-1}X^TE_{Y|X}(y)\\
	&=(X^TX)^{-1}X^TX\beta\\
	&=\beta
	\end{aligned}$$
</p>
<p>可见，用最小二乘法所估计出来的模型参数是无偏估计。<br>
$$\begin{aligned}Var_{Y|X}(\hat \beta)
		&=E_{Y|X}[(\hat{\beta}-E_{Y|X}(\hat{\beta}))(\hat{\beta}-E_{Y|X}(\hat{\beta}))^T]\\
		&=E_{Y|X}[((X^TX)^{-1}X^T\varepsilon)((X^TX)^{-1}X^T\varepsilon)^T]\\
		&=E_{Y|X}[(X^TX)^{-1}X^T\varepsilon \varepsilon^TX(X^TX)^{-1}]\\
		&=(X^TX)^{-1}X^TE_{Y|X}(\varepsilon \varepsilon^T)X(X^TX)^{-1}\\
		&=(X^TX)^{-1}X^TX(X^TX)^{-1}E(\varepsilon \varepsilon^T)\\
		&=(X^TX)^{-1}E(\varepsilon \varepsilon^T)\\
		&=(X^TX)^{-1}[E(\varepsilon \varepsilon^T)-0]\\
		&=(X^TX)^{-1}[E(\varepsilon \varepsilon^T)-E^2(\varepsilon)]\\
		&=(X^TX)^{-1}Var(\varepsilon)\\
		&=(X^TX)^{-1}\sigma^2I_N\\
	\end{aligned}$$
</p>
<p>其中<br>
$$\begin{aligned}\hat{\beta}-E_{Y|X}(\hat{\beta})
	&=(X^TX)^{-1}X^Ty-\beta\\
	&=(X^TX)^{-1}X^Ty-(X^TX)^{-1}X^TX\beta\\
	&=(X^TX)^{-1}X^T(y-X\beta)\\
	&=(X^TX)^{-1}X^T\varepsilon\\
	\end{aligned}$$
</p>
<p>另外，如果我们能估计出$\sigma$，那么也就能估计出$Var(\hat \beta)$, 也就能求出$\hat \beta$的置信区间了。<br>我们知道，误差服从高斯分布<br>$$y-\hat y \sim N(0, \sigma^2I_N)$$</p>
$$\frac{y-\hat y}{\sigma} \sim N(0, I_N)$$
$$\frac{||y-\hat y||^2}{\sigma^2} \sim \chi^2_{dim(y-\hat y)}=\chi^2_{N-p-1}$$
$$||y-\hat y||^2 \sim \sigma^2 \chi^2_{N-p-1}$$
<p>残差平方和服从自由度为N-p-1的卡方分布(一个高斯分布的平方自然是$\chi ^ 2$分布了)，所以有<br>$$E||y-\hat y||^2 = (N-p-1)\sigma^2 $$</p>
<p> 则</p>
<p>$$\sigma^2 = \frac{1}{N-p-1}E||y-\hat y||^2$$</p>
$$\hat \sigma^2 = \frac{1}{N-p-1}\sum_{i=1}^N(y_i-\hat y_i)^2$$
<p>可证明，上面的$\hat \sigma$是$\sigma$的无偏估计。因此<br>$$E(\hat \beta)=\beta$$</p>
$$Var(\hat \beta)=(X^TX)^{-1}\hat \sigma^2I_N$$
<h2 id="的假设检验"><a href="#的假设检验" class="headerlink" title="的假设检验"></a>$\hat \beta_j$的假设检验</h2><h3 id="单个的假设检验"><a href="#单个的假设检验" class="headerlink" title="单个的假设检验"></a>单个$\hat \beta_j$的假设检验</h3><p>由$\hat{\beta} = (X^TX)^{-1}X^Ty$，以及y服从高斯分布可知，$\hat{\beta}$也服从高斯分布<br>$$\hat{\beta} \sim N(\beta, (X^TX)^{-1}\hat \sigma^2I_N)$$</p>
<p>写成分量形式，对于 j=1,2,…,N,<br>$$\hat{\beta_j} \sim N(\beta_j, v_{jj} \hat \sigma^2)$$</p>
<p>其中，$v_{jj}$为$(X^TX)^{-1}$的第j个对角元，$v_{jj} \hat \sigma^2$是$\hat{\beta_j}$的方差，其标准差应为$\sqrt{v_{jj}} \hat \sigma$。不过，我们不知道是否有$v_{jj} > 0$</p>
<p>设$u \in R^{p+1}$列向量，构造$w=(X^TX)^{-1}u$，也是p+1维列向量，自然有$u=X^TXw$，因此<br>
$$\begin{aligned}u^T(X^TX)^{-1}u
	&=(X^TXw)^T(X^TX)^{-1}X^TXw \\
	&=w^TX^TX(X^TX)^{-1}X^TXw \\
	&=w^TX^TXw \\
	&=(Xw)^T(Xw) \geq0
	\end{aligned}$$
<br>显然，只有当u=0时，才有w=0,进而才恒有$u^T(X^TX)^{-1}u=0$, 因此$(X^TX)^{-1}$正定，故$v_{jj}>0$，此时我们可以写出参数$\hat \beta_j$的z分数了。<br>$$z=\frac{\hat \beta_j}{std(\hat \beta_j)}=\frac{\hat \beta_j}{ \sqrt{v_{jj}}\hat \sigma} \sim t_{N-p-1}$$</p>
<p>在原假设$\hat \beta_j=0$下，z服从自由度为N-p-1的t分布(一个高斯分布除以一个$\chi ^ 2$分布的平方根，自然是t分布了)，绝对值大的z分数，其对应的p值(可以查t分布表)也就越小，越可以拒绝原假设，即$\hat \beta_j>0$，相应的特征$X_j$应该被保留。<br>当N足够大时，t分布近似于高斯分布，t分布的尾分数与高斯分布的尾分数几乎相等，因此也可认为z服从高斯分布。这是一般的假设检验过程，这里不详述了。</p>
<h3 id="多个的假设检验"><a href="#多个的假设检验" class="headerlink" title="多个的假设检验"></a>多个$\hat \beta_j$的假设检验</h3><p>F统计量可检验一组系数是否可置0,<br>$$F=\frac{(RSS_0-RSS_1)/(p_1-p_0)}{RSS_1/(N-p_1-1)}$$</p>
<p>其中$RSS_1$是用较大模型(参数多)算出来的残差平方和，$p_1$是该模型的参数数量(特征维数)，$RSS_0$是较小模型的残差平方和，$p_0$是该模型的参数数量(特征维数)。在高斯假设下，设较小模型更正确为零假设下，F统计量服从$F_{p_1-p_0, N-p_1-1}$分布，可查表得到相应p值以判断是否拒绝原假设，即较小模型是否更好。</p>
<h2 id="的置信区间"><a href="#的置信区间" class="headerlink" title="的置信区间"></a>$\hat \beta_j$的置信区间</h2><p>上面提到参数$\hat \beta_j$的z分数<br>$$z=\frac{\hat \beta_j}{ \sqrt{v_{jj}\hat \sigma^2}} \sim t_{N-p-1}$$</p>
<p>z服从自由度为N-p-1的t分布，那么z的$1-\alpha$置信区间为<br>$$(-z^{1-{\alpha \over 2}}, z^{1-{\alpha \over 2}})$$</p>
<p>因此真实模型参数$\beta_j$的$1-\alpha$置信区间为<br>$$(\hat \beta_j-z^{1-{\alpha \over 2}}v_{jj}^{1 \over 2}\hat \sigma, \hat \beta_j+z^{1-{\alpha \over 2}}v_{jj}^{1 \over 2}\hat \sigma)$$</p>
<p>其中$z^{1-{\alpha \over 2}}$可通过查表得到。比如我想要个95%置信区间<br>$$\alpha=1-0.95=0.05$$</p>
<p>$$1-{\alpha \over 2}=1-0.025=0.975$$</p>
<p>若样本较多，N很大，可查标准正太分布表有<br>$$z^{1-{\alpha \over 2}}=z^{0.975}=1.96$$</p>
<p>所以$\beta_j$的95%置信区间为<br>$$(\hat \beta_j-1.96v_{jj}^{1 \over 2}\hat \sigma, \hat \beta_j+1.96v_{jj}^{1 \over 2}\hat \sigma)$$</p>
<hr>
<p>总结自The Elements of Statistical Learning</p>
<hr>
<p><div id="container"></div></p>
<p><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"></p>
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  id: 'linear_regression',
  title: '线性回归',
  owner: 'yiyang186',
  repo: 'blog_comment',
  oauth: {
    client_id: '2786ddc8538588bfc0c8',
    client_secret: '83713f049f4b7296d27fe579a30cdfe9e2e45215',
  },
})
gitment.render('container')
</script>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/06/怎样用scipy求一些统计量的p值和分位数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/06/怎样用scipy求一些统计量的p值和分位数/" itemprop="url">怎样用scipy求一些统计量的p值和分位数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-06T11:05:00+08:00">
                2016-10-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/操作/" itemprop="url" rel="index">
                    <span itemprop="name">操作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>scipy.stats模块中有不少涉及计算统计量的子模块<br>如<br>scipy.stats.uniform<br>scipy.stats.norm<br>scipy.stats.t<br>scipy.stats.chi2<br>scipy.stats.f<br>更多子模块参见<a href="http://docs.scipy.org/doc/scipy/reference/stats.html" target="_blank" rel="external">这里</a></p>
<p>其中scipy.stats.f内有如下方法：<br><img src="http://img.blog.csdn.net/20161006104131553" alt="图一"><br>来自于<a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.f.html#scipy.stats.f" target="_blank" rel="external">这里</a></p>
<p>这些方法在其他子模块中都大同小异。这里重点介绍求F统计量的p值和分位数，t统计量，卡方，正态，的求法基本类似。</p>
<p>例1：求$Pr(F_{4,58}>1.67)=?$,即已知临界值求p值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from scipy.stats import f</div><div class="line">&gt;&gt;&gt; f.sf(1.67, 4, 58)</div><div class="line">0.16927935111708425</div><div class="line">&gt;&gt;&gt; 1 - f.cdf(1.67, 4, 58)</div><div class="line">0.16927935111708448</div></pre></td></tr></table></figure></p>
<p>例2：求$F_{4,58}^{(1-0.17)}=?$ ,即已知p值求临界值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; from scipy.stats import f</div><div class="line">&gt;&gt;&gt; f.isf(0.17, 4, 58)</div><div class="line">1.666945416681088</div><div class="line">&gt;&gt;&gt; f.ppf(1 - 0.17, 4, 58)</div><div class="line">1.666945416681088</div></pre></td></tr></table></figure></p>
<p>其中，isf是sf的逆运算， ppf是cdf的逆运算。具体解释参见上图。其他统计量的相关计算方法与之类似，不同之处就是少了自由度作为参数。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/08/28/centos安装caret包失败/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/28/centos安装caret包失败/" itemprop="url">centos安装caret包失败</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-28T10:02:00+08:00">
                2016-08-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/操作/" itemprop="url" rel="index">
                    <span itemprop="name">操作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>实验室的redhat用的是centos源，跟centos情况应该差不多。</p>
<p>当我安装caret时，R提示我以下这些包安装失败<br> ‘car’‘nloptr’, ‘lme4’, ‘pbkrtest’‘minqa’</p>
<p>理清依赖关系，最根源的问题是minqa和nloptr安装失败。</p>
<h1 id="安装minqa"><a href="#安装minqa" class="headerlink" title="安装minqa"></a>安装minqa</h1><p>安装minqa失败的原因是ld找不到libgfortran.so, 由于我已经安装了gcc, 应该有libgfortran.so的。后来我在/usr/lib64/下边找到了libgfortran.so.3.0.0（你也可能会在/usr/lib或者/usr/local/lib、/usr/local/lib64里找到）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln -sv /usr/lib64/libgfortran.so.3.0.0 /usr/lib64/libgfortran.so</div></pre></td></tr></table></figure></p>
<p>然后再到R里安装minqa就行了。</p>
<h1 id="安装nloptr"><a href="#安装nloptr" class="headerlink" title="安装nloptr"></a>安装nloptr</h1><p>在stack overflow里搜到的办法是, 系统需要安装nlopt和nlopt-devel<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install nlopt nlopt-devel</div></pre></td></tr></table></figure></p>
<p>回到R就可以安装nloptr了</p>
<h1 id="安装caret包"><a href="#安装caret包" class="headerlink" title="安装caret包"></a>安装caret包</h1><p>接下来安装caret包就很顺利了，要是不顺利的话，再把上述依赖包一个一个安装，看看是什么问题，一个一个解决。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/08/python解压rar文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/08/python解压rar文件/" itemprop="url">python解压rar文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-08T11:49:00+08:00">
                2016-07-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/操作/" itemprop="url" rel="index">
                    <span itemprop="name">操作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><p>在数据预处理阶段，有时候会发现我们的数据存储在大量杂乱无章的压缩文件中，这些压缩文件还可能处在复杂的目录树结构下。这时候你可能会想写个python脚本来处理。<br>对于zip文件，python 的zipfile模块提供了很好的支持，但是对于rar格式的压缩文件，要麻烦一点。</p>
<h1 id="安装unrar"><a href="#安装unrar" class="headerlink" title="安装unrar"></a>安装unrar</h1><p><a href="https://pypi.python.org/pypi/unrar/" target="_blank" rel="external">unrar</a>是python下支持解压rar文件的插件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install unrar</div></pre></td></tr></table></figure></p>
<p>不过这个插件需要rarlib的支持，不然无法解压</p>
<h1 id="安装rarlib"><a href="#安装rarlib" class="headerlink" title="安装rarlib"></a>安装rarlib</h1><p>到<a href="http://www.rarlab.com/rar_add.htm" target="_blank" rel="external">这个网页</a>去下载相应版本的rarlib，由于我用的是windows系统，所以下载了UnRAR.dll。<br>我照着unrar文档中的方式设置UnRAR.dll的环境变量，结果毫无效果，看看报错，摸索出来了一个方法。<br>将安装好后的rarlib目录加入环境变量path（由于我的是64bit系统，所以只加入了rarlib目录下的64子目录）。由于unrar模块要搜索名为unrar.dll的文件，所以需要把目录中的UnRAR.dll， UnRAR.lib（UnRAR64.dll, UnRAR64.lib）改为unrar.dll，unrar.lib<br>这样unrar就可以顺利解压rar文件了</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/27/sqlcmd简单指令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/27/sqlcmd简单指令/" itemprop="url">sqlcmd简单指令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-27T13:51:00+08:00">
                2016-05-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/操作/" itemprop="url" rel="index">
                    <span itemprop="name">操作</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h1><ul>
<li>sql server 2008</li>
<li>注意1433端口是否打开[^1]</li>
</ul>
<h1 id="登陆数据库"><a href="#登陆数据库" class="headerlink" title="登陆数据库"></a>登陆数据库</h1><p>sqlcmd -S 数据库服务器地址 -U 用户名 -P 密码<br>或<br>sqlcmd -S 数据库服务器地址\数据库实例名 -U 用户名 -P 密码</p>
<h1 id="查询数据库"><a href="#查询数据库" class="headerlink" title="查询数据库"></a>查询数据库</h1><ol>
<li><p>查看有哪些数据库<br>>1 SELECT name FROM sys.databases<br>>2 GO<br>每次输入sql语句都要打一行go, 下面不再赘述，sys.databases是系统默认的全局变量（学过sql, 但没专门学过sql server，姑且这么叫吧）</p>
</li>
<li><p>切换数据库上下文<br>USE 数据库名</p>
</li>
<li><p>查看数据库里有哪些表<br>SELECT name FROM sysobjects</p>
</li>
<li><p>查看表中的列名<br>SELECT name FROM syscolumns WHERE id=object_id(‘表名’)</p>
</li>
<li><p>其他<br>sql server用的sql语句叫做Transact-SQL（T-SQL）, 跟sql还有点不一样，具体请参见<a href="http://imdbt.blog.51cto.com/903896/218590" target="_blank" rel="external">T-SQL经典语句</a>，以及<a href="https://msdn.microsoft.com/zh-cn/library/ms177563(v=sql.100" target="_blank" rel="external">官方文档</a>.aspx)。</p>
</li>
</ol>
<h1 id="从CSV文件导入数据库"><a href="#从CSV文件导入数据库" class="headerlink" title="从CSV文件导入数据库"></a>从CSV文件导入数据库</h1><p>先为要导入的数据建表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名( </div><div class="line">	列<span class="number">1</span> <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>), </div><div class="line">	列<span class="number">2</span> <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>), </div><div class="line">	列<span class="number">3</span> <span class="keyword">NVARCHAR</span>(<span class="keyword">MAX</span>) </div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>从csv文件中导入数据<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">BULK <span class="keyword">INSERT</span> 表名</div><div class="line"><span class="keyword">FROM</span> <span class="string">'csv文件路径名'</span></div><div class="line"><span class="keyword">WITH</span>(</div><div class="line">	FIELDTERMINATOR = <span class="string">','</span>,</div><div class="line">	ROWTERMINATOR = <span class="string">'\n'</span></div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>[^1]: 到sql server configuration manager里的network configuration里去设置tcp/ip的端口（IP Address选项卡拉到最下面）为1433，再重启sql server services即可，具体步骤请参见<a href="http://www.cnblogs.com/skynothing/archive/2010/08/26/1809125.html" target="_blank" rel="external">解决sqlserver 2008 sqlcmd无法登陆</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/16/几种协议/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/16/几种协议/" itemprop="url">几种网络协议</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-16T22:49:00+08:00">
                2016-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络/" itemprop="url" rel="index">
                    <span itemprop="name">网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>ARP, Address Resolution Protocol，地址解析协议<br>地址解析：物理网络使用的是硬件地址进行报文传输，IP地址不能被物理网络所识别。所以必须建立两种地址的映射关系，这个过程称为地址解析。ARP是动态协议，即地址解析这个过程是自动完成的。<br>ARP缓存：每台使用ARP的主机，保留了一个专用内存区(缓存),存放最近的IP地址与硬件地址的对应关系。</p>
<h2 id="ARP解析过程"><a href="#ARP解析过程" class="headerlink" title="ARP解析过程"></a>ARP解析过程</h2><h3 id="同一网段的ARP解析过程"><a href="#同一网段的ARP解析过程" class="headerlink" title="同一网段的ARP解析过程"></a>同一网段的ARP解析过程</h3><p>若PCA的ARP缓存中找不PCB的MAC地址，就广播ARP请求报文，其他主机忽略这个请求，只要IP地址是PCB的主机才会回应，将它自己的硬件地址写入应答报文后直接发给PCA。PCA收到后将其写入缓存。</p>
<h3 id="不同网段的ARP解析过程"><a href="#不同网段的ARP解析过程" class="headerlink" title="不同网段的ARP解析过程"></a>不同网段的ARP解析过程</h3><p>如PCB与PCA不再同一网段（根据PCB的IP地址和PCA自己的子网掩码），PCA想向PCB发报文，需要经过默认网关，解析过程转换为解析同一网段的默认网关mac地址的过程。默认网关得到报文后再另一个网络中去重复ARP地址解析过程。在这里，PCA并不需要知道PCB的MAC地址，它只需要知道默认网关的MAC地址就行了，给其他网段的报文统统交给默认网关去处理。</p>
<h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><p>在cmd中通过命令”arp -a”查看ARP缓存，”arp -d”清空ARP缓存</p>
<h1 id="PPP协议"><a href="#PPP协议" class="headerlink" title="PPP协议"></a>PPP协议</h1><h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><p>PPP（Point to Point Protocol）即点对点协议,是一种广域网链路层协议，可以帮助隔了很多个异构网络的两端实现逻辑直连。我们常用的宽带拨号就是PPPoE协议(Point to Point Protocol over Ethernet)，即以太网上的点对点协议。PPP有身份认证的功能，当运营商确认了我们的身份后才会给我们分配IP地址，我们才可以上网。</p>
<h3 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h3><ol>
<li>一个将IP数据报封装到串行链路的方法。</li>
<li>一个用来建立、配置和测试数据链路链接的链路控制协议LCP(Link Control Protocol)，用于通信双方协商选项</li>
<li>一套网络控制协议(NCP，Network Control Protocol)，支持不同的网络层协议</li>
</ol>
<h2 id="两种验证方式"><a href="#两种验证方式" class="headerlink" title="两种验证方式"></a>两种验证方式</h2><h3 id="PAP"><a href="#PAP" class="headerlink" title="PAP"></a>PAP</h3><p><strong>特点</strong>：验证从客户端发起，密码明文传输，仅在连接建立阶段进行，数据传输阶段不进行PAP验证.<br><strong>过程</strong>: </p>
<ol>
<li>A与B间通过PPP协议互联，A设置为验证方，B为被验证方，当B拨通A后，B会将用户名（一般设置为路由器的名字）与口令一起发给A；</li>
<li>验证方A根据本端的数据库查看是否有此用户，口令是否正确。如正确则会给对端发送ACK报文，通告对端已被允许进入下一阶段协商；否则发送NAK报文，通告对端验证失败。<h3 id="CHAP"><a href="#CHAP" class="headerlink" title="CHAP"></a>CHAP</h3>略</li>
</ol>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>我们学校通过串口连接两个路由器，做这个实验需要进入Serial 0/0配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[R1]inter Serial 0/0</div><div class="line">[R1-Serial0/0]ip address 192.0.0.1 24</div><div class="line">[R1-Serial0/0]link-protocol ppp # 启动PPP</div><div class="line">[R1-Serial0/0]shutdown</div><div class="line">[R1-Serial0/0]undo shutdown # 需要重启端口才会生效</div><div class="line"># R2也需要进行类似配置,并测试是否能ping通</div><div class="line">&lt;R1&gt;debugging ppp all</div><div class="line">&lt;R1&gt;terminal debugging</div><div class="line">[R1-Serial0/0]shutdown</div><div class="line">[R1-Serial0/0]undo shutdown</div></pre></td></tr></table></figure></p>
<h3 id="LCP状态转移图"><a href="#LCP状态转移图" class="headerlink" title="LCP状态转移图"></a>LCP状态转移图</h3><p>根据R1的debug信息画出LCP状态转移图<br><img src="http://img.blog.csdn.net/20160516173207816" alt="这里写图片描述"></p>
<h3 id="PAP验证状态转移图"><a href="#PAP验证状态转移图" class="headerlink" title="PAP验证状态转移图"></a>PAP验证状态转移图</h3><p>这里用R1为主验证方，来验证R2，用户名RTB, 密码aaa<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[R1]local-uer RTB class network # 配置用户列表</div><div class="line">[R1-user-RTB]service-type ppp # 配置服务类型</div><div class="line">[R1-user-RTB]password simple aaa # 这是该用户密码</div><div class="line">[R1-user-RTB]quit</div><div class="line">[R1]inter Serial 0/0</div><div class="line">[R1-Serial0/0]ppp authentication pap # 为s0/0端口授权PAP验证</div><div class="line"># 重启端口，生效配置</div><div class="line">[R1-Serial0/0]shutdown</div><div class="line">[R1-Serial0/0]undo shutdown</div></pre></td></tr></table></figure></p>
<p>重启端口，不是路由器。还要在R2添加R1的用户名和密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[R2]inter Serial 0/0</div><div class="line"># 在该端口添加用户名和密码</div><div class="line">[R2-Serial0/0]ppp pap local-user RTB password simple aaa</div><div class="line"># 重启端口，生效配置</div><div class="line">[R1-Serial0/0]shutdown</div><div class="line">[R1-Serial0/0]undo shutdown</div></pre></td></tr></table></figure></p>
<p>执行下列指令显示debug信息，画出PAP状态转移图<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">验证R1是否能ping通R2</div><div class="line">&lt;R1&gt;debugging ppp all</div><div class="line">&lt;R1&gt;terminal debugging</div><div class="line">[R1-Serial0/0]shutdown</div><div class="line">[R1-Serial0/0]undo shutdown</div></pre></td></tr></table></figure></p>
<h1 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h1><h2 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h2><p>这里不介绍报文格式了，直接上图，记住报头至少20个字节就好了。<br><img src="http://img.blog.csdn.net/20160516203037693" alt="这里写图片描述"><br>这是一份封装了ICMP报文的IP报文，下面灰色的字节是IP的报头，报头后的字节是数据部分</p>
<p>报文在网络中的传输主要分为</p>
<ol>
<li>主机发送：直接交付和间接交付。通过对目的地址和子网掩码相与来判断目的主机是否和自己在同一网络，如在同一网络则直接交付，若不在同以网络将报文交给路由器(默认网关)间接交付，至于路由器怎么交付，我主机不care.</li>
<li>路由器转发：将目的地址和路由器各端口的子网掩码相与，若目的主机在与路由器直接相连的网络中则直接交付。否则，查找本路由器的路由表，转发给路由表指示的下一跳路由器。路由表中每一行都要“目的网络地址，子网掩码，下一跳地址”,按最长匹配原则索引目的网络地址。如果没有匹配的就转发给默认路由。至于下一跳路由怎么做，本路由不care.</li>
</ol>
<p><strong>路由</strong><br>控制报文进行转发的路径信息，存储路由信息的表格称为路由表，路由表如何生产？有静态配置(手动设置)和动态生成两种方法。</p>
<p><strong>路由表，ARP表，MAC表</strong>：<br>路由表根据目的网络（目的）索引下一跳地址， ARP缓存(ARP表)根据IP地址索引MAC地址，MAC地址表根据MAC地址索引发送端口。这一套使用下来，路由器就知道该从哪个端口发送数据了。</p>
<p><strong>独臂路由</strong><br>独臂路由解决的是不同VLAN 间的通信问题，它是用一个物理接口来划分出多个逻辑子接口来当做物理接口来用，这样可以节约真正的物理接口。VLAN之间的数据传输先要进入路由器处理，然后输出，以使得网络中的大部分报文在同一个VLAN内的传输将用不着通过路由器而直接在交换设备间进行高速传输。</p>
<h2 id="配置静态路由"><a href="#配置静态路由" class="headerlink" title="配置静态路由"></a>配置静态路由</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 参数为目的IP，子网掩码，下一跳地址</div><div class="line">[R1]ip route-static 192.168.10.10 24 192.168.2.1 </div><div class="line"># 配置缺省路由（缺省路由是静态的）</div><div class="line">[R1]ip route-static 0.0.0.0 0.0.0.0 192.168.2.1</div></pre></td></tr></table></figure>
<h1 id="RIP协议"><a href="#RIP协议" class="headerlink" title="RIP协议"></a>RIP协议</h1><h2 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h2><p><strong>动态路由</strong>（dynamic route ）</p>
<ul>
<li>路由表项是路由协议动态生成</li>
<li>根据网络结构或流量的变化，路由协议会自动调整路由信息以实现路由。</li>
</ul>
<p><strong>动态路由协议</strong></p>
<ul>
<li>按网络范围划分<br>内部网关协议－RIP，OSPF，IS-IS<br>外部网关协议－EGP，BGP</li>
<li>按寻径算法划分<br>距离矢量协议－RIP，BGP<br>链路状态协议－OSPF，IS-IS</li>
</ul>
<p><strong>RIP协议</strong><br>RIP协议是一种动态路由协议，按网络范围划分是一种内部网关协议（IGP），用于自治系统（AS）内的路由信息的传递。RIP协议基于距离矢量算法（Distance Vector Algorithms），使用“跳数”(即metric)来衡量到达目标地址的路由距离。这种协议的路由器只关心自己周围的世界，只与自己相邻的路由器交换信息，范围限制在15跳(15度)之内，再远，它就不关心了。</p>
<h2 id="RIP协议原理"><a href="#RIP协议原理" class="headerlink" title="RIP协议原理"></a>RIP协议原理</h2><p>RIP路由协议的设计比较简单，在相邻的路由器之间周期性地交换整个路由表，并应用距离矢量算法来计算路由。<br><img src="http://img.blog.csdn.net/20160517103941967" alt="这里写图片描述"></p>
<ol>
<li><p>初始时刻，每台路由器上只有自身的直连路由，当启动RIP协议后，在第一个30秒内，所有路由器会向邻居路由器发送自己的完整的路由表。<br><img src="http://img.blog.csdn.net/20160517104029428" alt="这里写图片描述"></p>
</li>
<li><p>这时，路由器A和C收到了路由器B的路由表，路由器B则收到了路由器A和C的路由表，通过与自身的路由表进行比较，计算路由的跳数并更新路由表。这时路由器B已经有了全部网段的路由，而A和C分别缺4网段和1网段的路由。需要通过下一个时间周期的路由信息交换来获得。<br><img src="http://img.blog.csdn.net/20160517104525851" alt="这里写图片描述"></p>
</li>
<li><p>由于路由器B已经获得了A和C的路由信息，因此在第二个30秒，路由器A可以从B那里获得C的信息，同样C也可以从B那里获得A的信息，这样ABC都获得了全部网段的路由信息。<br><img src="http://img.blog.csdn.net/20160517104806167" alt="这里写图片描述"></p>
</li>
</ol>
<h2 id="路由环路问题"><a href="#路由环路问题" class="headerlink" title="路由环路问题"></a>路由环路问题</h2><ol>
<li><p>RIP协议在设计中没有考虑路由环路的问题，使得它存在重大缺陷。例如，当整个路由信息交换完成后，如果突然与路由器A相连的1网段链路发生故障，其S1接口为down状态，该路由项将被删除，如果此时路由器A还没有到向其他路由器通告它的路由表的时间，却收到了来自路由器B的路由通告。<br><img src="http://img.blog.csdn.net/20160517104959513" alt="这里写图片描述"></p>
</li>
<li><p>这时，路由器A会认为到1网段还有另外一条途径，它无法判断这条路由信息实际上是之前它发送给路由器B的。路由器A更新1网段路由信息，与下一跳路由器相连的接口改为S0，跳数为2.随后，路由器A会将其新的路由表通告给相邻路由器B，因为路由器B中的1网段路由是从路由器A学习的，因此路由器B会更新1网段的路由，将跳数加1.这样，路由器A、B、C的1网段的路由的跳数会不断的增加下去，直到溢出。而此时，如果有目的IP地址是1网段的报文被路由器C转发到路由器B，路由器B会将该报文转发给路由器A，而路由器A又会将此报文转发回路由器B，如此往复，直至报文的TTL字段值为0后，报文被丢弃。报文路由器A和B之间循环转圈就称为路由环路。它会很快的消耗掉连接A、B路由器的链路的带宽，对网络的危害很大。<br><img src="http://img.blog.csdn.net/20160517105257751" alt="这里写图片描述"></p>
</li>
<li><p>针对这种情况，RIP协议进行了很多的改进，例如：定义最大路由权值、触发更新、毒性逆转。但是，都没能够从根本上解决问题，使得RIP协议的使用受到了很大的限制。而究其主要原因，路由信息中没有携带始发通告路由器是主要原因。<br><img src="http://img.blog.csdn.net/20160517105351136" alt="这里写图片描述"></p>
</li>
</ol>
<h1 id="OSPF协议"><a href="#OSPF协议" class="headerlink" title="OSPF协议"></a>OSPF协议</h1><h2 id="概念-4"><a href="#概念-4" class="headerlink" title="概念"></a>概念</h2><p>Open Shortest Path First，开放最短路由优先协议一个基于链路状态（Link status）的内部网关协议。<br><strong>核心思想</strong><br>每一台路由器将其周边的链路状态(接口直连网段、相连的路由器等信息)描述出来，发送给网络中相邻的路由器。经过一段时间的链路状态信息交互，每台路由器都保存了一个链路状态数据库，该数据库是整个网络完整的链路状态描述，最后在此基础上应用Shortest Path First算法计算路由(最短路径)。</p>
<p><strong>AS自治系统</strong><br>使用同一组选路策略的路由器的集合，OSPF就应用在AS内部，除了OSPF协议还可以使用RIP, IS-IS协议，自治系统间可以使用BGP协议。</p>
<p><strong>区域</strong><br>OSPF将一个AS分成多个区域，一个区域有着相同的拓扑结构数据库。区域ID用一个32BIT的整数来标示，可以用IP地址格式表示也可以用一个十进制整数表示。</p>
<p><strong>Router ID</strong><br>OSPF协议使用Router ID唯一表示一台路由器，采用IP地址的形式表示，可认为指定，也可能是路由器的回环地址或者最大的地址。</p>
<h2 id="OSPF报文"><a href="#OSPF报文" class="headerlink" title="OSPF报文"></a>OSPF报文</h2><p>如下图所示，OSPF协议直接用IP报文来封装自己的协议报文，其中LSA(Link Status Advertisement)为链路状态通告，路由器将把自己的链路状态以LSA报文的形式封装，作为OSPF的数据部分，与邻近的路由器分享自己的链路拓扑。<br><img src="http://img.blog.csdn.net/20160517093123045" alt="这里写图片描述"></p>
<p>上图中的OSPF报头的格式如下<br><img src="http://img.blog.csdn.net/20160517093404604" alt="这里写图片描述"><br>上图第2个字段“type”指出该OSPF报文的类型，数值从1到5分别是下列5种类型</p>
<h3 id="OSPF协议报文的5种类型"><a href="#OSPF协议报文的5种类型" class="headerlink" title="OSPF协议报文的5种类型"></a>OSPF协议报文的5种类型</h3><ul>
<li>Hello报文: 发现及维持邻居关系，选举DR(指定路由器)，BDR(备份指定路由器)。</li>
<li>DD报文: 本地LSDB的摘要</li>
<li>LSR报文: 向对端请求本端没有或对端的更新的LSA</li>
<li>LSU报文: 向对方发送其需要的LSA</li>
<li>LSAck报文: 收到LSU之后，进行确认</li>
</ul>
<p>下图为一段DD报文，与上面的报文格式对照会理解的清楚一些<br><img src="http://img.blog.csdn.net/20160517094959183" alt="这里写图片描述"></p>
<h2 id="OSPF协议的邻居状态机"><a href="#OSPF协议的邻居状态机" class="headerlink" title="OSPF协议的邻居状态机"></a>OSPF协议的邻居状态机</h2><p>OSPF协议获取网络拓扑结构的过程是自动的，它从开始到最后获得邻居所有的链路信息(建立邻接状态)需要经过许多过程，OSPF的邻居状态机显示了在这个协商过程中路由器状态的变化。</p>
<ul>
<li>Down： 邻居状态机的初始状态，是指在过去的Dead-Interval时间内没有收到对方的Hello报文 </li>
<li>Attempt： 只适用于NBMA类型的接口，处于本状态时，定期向那些手工配置的邻居发送HELLO报文 </li>
<li>Init ： 本状态表示已经收到了邻居的HELLO报文，但是该报文中列出的邻居中没有包含本Router ID（对方并没有收到我发的HELLO报文） </li>
<li>2-Way ：本状态表示双方互相收到了对端发送的HELLO报文，建立了邻居关系。在广播和NBMA类型的网络中，两个接口状态是DROther的路由器之间将停留在此状态。其他情况状态机将继续转入高级状态。</li>
<li>ExStart ： 在此状态下，路由器和它的邻居之间通过互相交换DD报文（该报文并不包含实际的内容，只包含一些标志位）来决定发送时的主/从关系。建立主/从关系主要是为了保证在后续的DD报文交换中能够有序的发送。 </li>
<li>Exchange ： 路由器将本地的LSDB用DD报文来描述，并发给邻居 </li>
<li>Loading ： 路由器发送LSR报文向邻居请求对方的LSU报文 </li>
<li>Full ： 在此状态下，邻居路由器的LSDB中所有的LSA本路由器全都有了。本路由器和邻居建立了邻接状态 </li>
</ul>
<p><img src="http://img.blog.csdn.net/20160517095403049" alt="这里写图片描述"></p>
<h3 id="OSPF报文交互过程"><a href="#OSPF报文交互过程" class="headerlink" title="OSPF报文交互过程"></a>OSPF报文交互过程</h3><p>两台路由器的交互过程及其状态变化如下：<br><img src="http://img.blog.csdn.net/20160517100455336" alt="这里写图片描述"><br>注意上图中，路由器交互过程的第2，3步DD报文主从关系协商和交换摘要信息中的seq, I，M, MS字段在DD报文(OSPF报文中的一种类型)中的字段位置如下：<br><img src="http://img.blog.csdn.net/20160517101946175" alt="这里写图片描述"></p>
<h2 id="OSPF配置"><a href="#OSPF配置" class="headerlink" title="OSPF配置"></a>OSPF配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[R1]router id 1.1.1.1 # 为该路由器配置Router ID</div><div class="line">[R1]ospf 	# 启动OSPF进程</div><div class="line">[R1]area 0 	# 创建区域0,并进入区域0视图</div><div class="line"># 指定在1.1.1.0网段上应用OSPF0.0.0.255是反掩码</div><div class="line">[R1-ospf-1-area-0.0.0.0]network 1.1.1.0 0.0.0.255</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/14/虚拟局域网VLAN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/14/虚拟局域网VLAN/" itemprop="url">虚拟局域网VLAN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-14T23:23:00+08:00">
                2016-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络/" itemprop="url" rel="index">
                    <span itemprop="name">网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><ol>
<li>链路层的交换机可以隔离基于物理层的冲突域<a href="一个冲突域中的两个比特同时进行传输会发生冲突，所有的共享介质环境都是一个冲突域。两台计算机直接用网线连接，通过网桥或者集线器连接，都处在一个冲突域中。">^1</a></li>
<li>网络层的路由器可以隔离基于链路层的广播域<a href="网络中的某一设备同时向网络中所有的其它设备发送数据，这个数据所能广播到的范围即为广播域。">^2</a>。</li>
<li>一些属于同一个局域网的主机，也属于同一个广播域，当其中一台主机发送广播时，广播内的所有主机都能收到广播报文。</li>
<li>设置虚拟局域网VLAN可以利用交换机将一个大的广播域划分成多个小的广播域，即多个虚拟的局域网，避免了使用路由器的高成本(不是家里那种路由器)和路由器处理报文时繁琐的过程来隔离广播域，这样就可以减少过多的广播信息所形成的广播风暴啦，增加了网络的利用率。<br><img src="http://img.blog.csdn.net/20160514220006488" alt="这里写图片描述"><br>如上图中的LAN2，连接不同交换机的主机可以也划分到同一个VLAN中</li>
</ol>
<h1 id="实现VLAN"><a href="#实现VLAN" class="headerlink" title="实现VLAN"></a>实现VLAN</h1><h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>为一个大局域网内的各网络设备的端口标记，指明他们分别属于哪个VLAN，即配置VLAN ID[^3], 同一个VLAN ID的端口间的网络就是一个虚拟局域网(也是一个广播域)。同时，为那些在这个大局域网中传播的数据帧添加标签(tag)，网络设备的端口通过将数据帧的tag和自己的VLAN ID比对，以此来确定该数据帧是否属于本VLAN。<br>802.1q标准规定在原有以太网帧格式中增加tag域，用来标示数据帧所属的VLAN ID<br><img src="http://img.blog.csdn.net/20160514213901257" alt="这里写图片描述"></p>
<h2 id="VLAN数据帧的传输"><a href="#VLAN数据帧的传输" class="headerlink" title="VLAN数据帧的传输"></a>VLAN数据帧的传输</h2><p>由于任何主机都不支持带有tag域的以太网帧，所以网络设备将VLAN以太网帧发送给交换机和主机时要区别对待。(上层的路由器不受影响)。以太网帧在VLAN交换机间传递要打上tag域，要传给主机，则要删除tag域。如果交换机收到的数据帧没有tag域，就默认它属于该端口的缺省VLAN(一个端口可以有多个VLAN, 缺省的VLAN就是原来的大局域网， H3C交换机中缺省VLAN是VLAN 1, 不打标签)。<br><img src="http://img.blog.csdn.net/20160514220812374" alt="这里写图片描述"></p>
<h2 id="VLAN端口分类"><a href="#VLAN端口分类" class="headerlink" title="VLAN端口分类"></a>VLAN端口分类</h2><ul>
<li><strong>Access端口</strong>（不打标签）：只能属于1个VLAN，从该端口出去的数据包不带TAG，一般接主机或路由器；</li>
<li><strong>trunk端口</strong>：可以属于多个VLAN，可以接收和发送带多种VLAN标签的报文，一般用于交换机之间连接的端口；</li>
<li><strong>hybrid端口</strong>：可以属于多个VLAN，可以接收和发送多个VLAN的报文，可以用于交换机之间连接，也可以用于接用户的计算机。属于Access和trunk的混合模式。</li>
</ul>
<p>Hybrid端口和trunk端口的不同之处在于hybrid端口可以允许多个VLAN的报文不打标签，而trunk端口只允许<strong>缺省VLAN</strong>的报文不打标签。因为Hybrid端口可以接主机，从主机过来或发向主机的数据帧不管属于哪个VLAN都不打标签。而trunk端口连交换机，除了默认VLAN以为的数据帧都必须打标签。</p>
<h2 id="VLAN的配置"><a href="#VLAN的配置" class="headerlink" title="VLAN的配置"></a>VLAN的配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[S1]vlan 2 # 创建VLAN 2</div><div class="line"># 将e0/1-e0/5端口添加进VLAN2</div><div class="line">[S1-VLAN2]port Ethernet1/0/1 to Ethernet1/0/5 </div><div class="line">[S1-VLAN2]quit</div><div class="line"># 用同样的方法配置VLAN3</div><div class="line">[S1]vlan 3</div><div class="line">[S1-VLAN3]port Ethernet1/0/20 to Ethernet1/0/24 </div><div class="line">[S1-VLAN3]quit</div><div class="line"># 为端口配置VLAN端口类型</div><div class="line">[S1]inter Ethernet1/0/1</div><div class="line">[S1-Ethernet1/0/1]port link-type trunk # 设置该端口为trunk类型</div><div class="line"># 将该Trunk端口加入到VLAN2和VLAN3中</div><div class="line">[S1-Ethernet1/0/1]port trunk permit VLAN 2 3</div></pre></td></tr></table></figure>
<p>注意：应先配置好VLAN, 有那些端口，再去端口或者聚合端口视图中设置端口类型，如果一个端口属于多个VLAN, 还要在端口中另外设置。</p>
<ul>
<li><strong>什么情况下VLAN 要配置trunk？</strong><br>为了让不同交换机上相同的VLAN内的主机能彼此通信。如下图的VLAN2（PCA和PCC）和VLAN3(PCB和PCD).<br>当没有配置VLAN时，PCA ping PCC是没有问题的，S1收到PCA的帧后查找转发表，如果没有找到PCB就把PCA的入端口和MAC地址记下来（当有主机想联系PCA时使用)然后向除了E0/1以为的端口广播，S2也做类似的事，所以数据帧可以到达PCC。<br>而一旦设置了VLAN而没有配trunk，由于S1不能向其他端口广播了， 因此就无法ping通。因为当PCA ping PCC时, S1看了一下从PCA发过来的数据帧的tag, 不知道应该把数据帧应从哪个端口发送出去，总不能原路发回来吧，而且交换机毕竟不是路由器，不能根据IP地址和子网掩码来判断要转发的目的子网以及连接该子网的端口。而当我们为S1和S2的E0/13端口配置了trunk，且设置这2个trunk端口属于VLAN2, 那么S1和S2都将知道如何转发数据报了。<br><img src="http://img.blog.csdn.net/20160514231043816" alt="这里写图片描述"></li>
</ul>
<p>[^3]: VLAN ID的范围为0~4095（VLAN ID占12bit）</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/14/端口聚合/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/14/端口聚合/" itemprop="url">端口聚合</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-14T17:33:00+08:00">
                2016-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络/" itemprop="url" rel="index">
                    <span itemprop="name">网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>将交换机的多个物理端口捆绑在一起，成为一个逻辑端口，这一组端口可以被看做一个端口使用。这样，这个聚合的端口</p>
<ol>
<li>有了更大的带宽(总带宽等于组内各端口带宽之和)</li>
<li>增加了端口冗余(只要剩一个没坏就能通信)</li>
<li>可以将负载均衡到组内的各个端口上。</li>
</ol>
<p>两个交换机间的链路两端都使用端口聚合，他们之间的链路就成为了聚合链路，同样具备上述3个特点，即更多带宽，更多冗余，负载均衡。</p>
<p><img src="http://img.blog.csdn.net/20160514173302071" alt="S1和S2间的聚合链路"></p>
<h1 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h1><p>关键：帧分发器、帧接收器<br>当交换机S1通过聚合链路向交换机S2发送数据时，从上层协议来的数据帧在链路层排队，由帧分发器按照一定规则将同样是发送给交换机S2的数据帧分发到不同的端口发送队列中去，交由各个端口分开发送。这里需要注意，帧分发器不会拆分数据帧，而且为了保证有序传输会将同一会话的数据帧分配到同一端口发送。当数据到达对端后，交换机S2的帧接收器将接受到的数据帧按接受顺序上交给上层协议。为什么可以直接按接收顺序上交？因为在交换机S1那里的帧发送器保证了数据帧的顺序。</p>
<p>注意：如果两个交换机之间有多条链路，而没有做端口聚合也没用使用生成树协议，将会产生广播风暴<a href="2个交换机间有多个链路，形成网络回路，是产生广播风暴的原因之一。当主机发送广播（如ARP请求）时，交换机S1转发该广播，交换机S2接收到该广播，由于没有找到目的主机，又继续广播。这时S1又收到了广播，然后他俩不断广播来，广播去，占尽网络带宽，形成广播风暴，交换机端口上的灯会不断闪烁。">^1</a></p>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>在没有使用生成树协议的情况下(undo stp enable)<br>这里我需要配置两路由器间的聚合链路，那么就需要先在俩交换机中配置端口聚合。（为了配置端口聚合，我不是道是不是还需要将每个端口的配置成一样的双工模式和速率，以前是需要的，先这么着吧，怕考试时出错）这里我需要聚合的端口包括端口e0/1和e0/2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[S1]interface Bridge-Aggregation 1 # 创建二层端口聚合组1</div><div class="line">[S1-Bridge-Aggregation1]link-aggregation mode dynamic # 设置动态聚合模式                                             </div><div class="line">[S1-Bridge-Aggregation1]inter Ethernet1/0/1</div><div class="line">[S1-Ethernet1/0/1]duplex full # 该端口全双工</div><div class="line">[S1-Ethernet1/0/1]speed 100 # 该端口速率</div><div class="line">[S1-Ethernet1/0/1]port link-mode bridge # 使端口工作在二层模式</div><div class="line">[S1-Ethernet1/0/1]port link-aggregation group 1 # 将该端口加入聚合组1</div><div class="line"># 下面是到e0/2再设置一遍</div><div class="line">[S1-Ethernet1/0/1]inter Ethernet1/0/2</div><div class="line">[S1-Ethernet1/0/2]duplex full</div><div class="line">[S1-Ethernet1/0/2]speed 100</div><div class="line">[S1-Ethernet1/0/2]port link-mode bridge</div><div class="line">[S1-Ethernet1/0/2]port link-aggregation group 1</div><div class="line">[S1-Ethernet1/0/2]quit</div><div class="line"># 配置全局聚合负载分担模式为按报文的目的MAC地址和源MAC地址实现聚合负载分担</div><div class="line">[S1]link-aggregation load-sharing mode destination-mac source-mac</div></pre></td></tr></table></figure></p>
<p>别忘了，在聚合链路的<strong>另一边的交换机</strong>也需要进行相同的配置。<br>如果还要配置vlan的truck/access/hybrid端口, 可以到这个聚合组中设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[S1]interface Bridge-Aggregation 1</div><div class="line">[S1-Bridge-Aggregation1] port access vlan 2</div><div class="line">[S1-Bridge-Aggregation1] quit</div></pre></td></tr></table></figure></p>
<p>最好在前面创建聚合组1的时候就把vlan端口类型设置上。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/13/NAT地址转换/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yiyang Peng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/7233064.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yiyang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/13/NAT地址转换/" itemprop="url">NAT地址转换</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-13T22:34:00+08:00">
                2016-05-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/网络/" itemprop="url" rel="index">
                    <span itemprop="name">网络</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>为了解决IPv4地址短缺的问题，通过内网到外网出口的NAT路由器(有NAT功能的路由器), 将许多的内网IP地址映射为少数的几个外网IP地址，使得内网只有私有地址的计算机也能上网。</p>
<h1 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h1><ol>
<li>内网PC向外网PC发送请求，途径某出口NAT路由器</li>
<li>该路由器先查看它自己是公网地址池，取出一条可用的公网地址，将“转换前的源地址和源端口号、转换后的源地址和源端口号”插入地址转换表中，便于外网PC响应时可以原路返回找到那台内网的PC</li>
<li>NAT路由器用新的源地址和源端口号，而目的地址和端口号不变，重新封装报文，再将报文发送出去</li>
<li>外网PC收到报文后发回应答报文，源地址和源端口号是刚才那条请求报文的目的地址和端口号，目的地址和端口号是NAT路由器封装后的源地址/端口号</li>
<li>NAT收到应答报文，再根据应答报文的目的地址和端口查找地址转换表，再将报文的目的地址和端口改过来，才发送到内网。</li>
<li>由于应答报文中的目的地址是内网的地址，因此内网中的那台PC能顺利收到应答报文<br><img src="http://img.blog.csdn.net/20160513214557643" alt="这里写图片描述"></li>
</ol>
<h1 id="H3C设置指令"><a href="#H3C设置指令" class="headerlink" title="H3C设置指令"></a>H3C设置指令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># 建立编号为2001的IPV4基本访问控制列表(Access Control Lists)[R1]acl basic 2001</div><div class="line"># 建立允许源地址为10.0.0.*(0.0.0.255为反掩码)的转换规则0</div><div class="line">[R1-acl-2001]rule 0 permit source 10.0.0.0 0.0.0.255 </div><div class="line"># 建立拒绝其他源地址的转换规则1</div><div class="line">[R1-acl-2001]rule 1 deny source any</div><div class="line"># 配置地址池1</div><div class="line">[R1]nat address-group 1</div><div class="line"># 为地址池1添加公网地址192.168.5.5-9</div><div class="line">[R1-address-group-1]address 192.168.5.5 192.168.5.9 </div><div class="line"># 进入e0/1接口</div><div class="line">[R1]inter GigabitEthernet 0/1</div><div class="line"># 配置出接口e0/1使用访问控制表2001和地址池1</div><div class="line">[R1-GigabitEthernet0/1]nat outbound 2001 address-group 1</div><div class="line">[R1-GigabitEthernet0/1]quit</div><div class="line"># 配置默认网关，参数分别是目的地址，子网掩码，下一条地址，</div><div class="line"># 如果目的地址和子网掩码都是0表示这是一条默认路由，</div><div class="line"># 下一条指向网关</div><div class="line">[R1]ip route-static 0.0.0.0 0.0.0.0 192.168.5.1</div></pre></td></tr></table></figure>
<p>ACL编号的取值范围及其代表的ACL类型如下：<br>100～199：表示WLAN ACL；<br>2000～2999：表示IPv4基本ACL；<br>3000～3999：表示IPv4高级ACL；<br>4000～4999：表示二层ACL。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/7233064.jpg"
               alt="Yiyang Peng" />
          <p class="site-author-name" itemprop="name">Yiyang Peng</p>
           
              <p class="site-description motion-element" itemprop="description">Try try try Never mind</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yiyang186" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/peng-yiyang-88" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yiyang Peng</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
